!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexlayermanagerplugin=e();}(undefined,(function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(r=i.key,o=void 0,"symbol"==typeof(o=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return ("string"===e?String:Number)(t)}(r,"string"))?o:String(o)),i);}var r,o;}function n(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&o(t,e);}function r(t){return r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},r(t)}function o(t,e){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},o(t,e)}function s(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return !1;if(Reflect.construct.sham)return !1;if("function"==typeof Proxy)return !0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return !1}}();return function(){var n,i=r(t);if(e){var o=r(this).constructor;n=Reflect.construct(i,arguments,o);}else n=i.apply(this,arguments);return s(this,n)}}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},u.apply(this,arguments)}var h={setEventEmitter:function(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter:function(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter:function(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames:function(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}},c={hasProperty:function(t){var e=this.gameObject;return !!e.hasOwnProperty(t)||void 0!==e[t]},getProperty:function(t){return this.gameObject[t]},setProperty:function(t,e){return this.gameObject[t]=e,this},easeProperty:function(t,e,n,i,r,o,s){var a=this.tweens,u=a[t];u&&u.remove();var h=this.gameObject,c={targets:h,duration:n,ease:i,repeat:r,yoyo:o,onComplete:function(){a[t].remove(),a[t]=null,s&&s(h,t);},onCompleteScope:this};return c[t]=e,(u=this.scene.tweens.add(c)).timeScale=this.timeScale,a[t]=u,this}},f={hasMethod:function(t){return "function"==typeof this.gameObject[t]},call:function(t){if(!this.hasMethod(t))return this;for(var e=this.gameObject,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return e[t].apply(e,i),this}},l=function(){function e(n,i,r){t(this,e),this.GOManager=n,this.tweens={},this.setGO(i,r);}return n(e,[{key:"scene",get:function(){return this.GOManager.scene}},{key:"timeScale",get:function(){return this.GOManager.timeScale}},{key:"destroy",value:function(){this.freeGO(),this.GOManager=void 0;}},{key:"freeTweens",value:function(){var t,e=this.tweens;for(var n in e)(t=e[n])&&t.remove(),e[n]=null;return this}},{key:"freeGO",value:function(){return this.freeTweens(),this.gameObject.destroy(),this.gameObject=void 0,this}},{key:"setGO",value:function(t,e){return t.setName(e),this.gameObject=t,this.name=e,this.freeTweens(),this}},{key:"setTimeScale",value:function(t){var e=this.tweens;for(var n in e){var i=e[n];i&&(i.timeScale=t);}return this}}]),e}();Object.assign(l.prototype,c,f,{hasData:function(t){var e=this.gameObject;return !!e.data&&e.data.has(t)},getData:function(t){return this.gameObject.getData(t)},setData:function(t,e){return this.gameObject.setData(t,e),this}});var v={tint:0,alpha:1},d={setGOFadeMode:function(t){return "string"==typeof t&&(t=v[t]),this.fadeMode=t,this},setGOFadeTime:function(t){return this.fadeTime=t,this},hasTintFadeEffect:function(t){return (void 0===this.fadeMode||0===this.fadeMode)&&this.fadeTime>0&&void 0!==t.setTint},hasAlphaFadeEffect:function(t){return (void 0===this.fadeMode||1===this.fadeMode)&&this.fadeTime>0&&void 0!==t.setAlpha},fadeBob:function(t,e,n,i){var r=t.gameObject;return this.hasTintFadeEffect(r)?(void 0!==e&&t.setProperty("tintGray",255*e),t.easeProperty("tintGray",Math.floor(255*n),this.fadeTime,"Linear",0,!1,i)):this.hasAlphaFadeEffect(r)?(void 0!==e&&t.setProperty("alpha",e),t.easeProperty("alpha",n,this.fadeTime,"Linear",0,!1,i)):i&&i(r),this}},y=function(t){return t>>16&255},p=function(t){return t>>8&255},m=function(t){return 255&t},b=Phaser.Events.EventEmitter,g=function(t,e,n,i,r,o){return void 0===o?o={}:!0===o&&(o=O),"number"!=typeof n&&(n=0,i=0),o.x=r.x+r.width*t+n,o.y=r.y+r.height*e+i,o},O={},w=function(t,e,n,i,r,o,s){if(t.hasOwnProperty("vp"))return t;"function"==typeof n&&(s=n,n=void 0),"function"==typeof r&&(s=r,r=void 0),void 0===n&&(n=.5),void 0===i&&(i=.5),void 0===r&&(r=0),void 0===o&&(o=0),void 0===s&&(s=g),function(t){if(t.events)return t;var e=new b,n=t.x;Object.defineProperty(t,"x",{get:function(){return n},set:function(i){n!==i&&(n=i,e.emit("update",t));}});var i=t.y;Object.defineProperty(t,"y",{get:function(){return i},set:function(n){i!==n&&(i=n,e.emit("update",t));}});var r=t.width;Object.defineProperty(t,"width",{get:function(){return r},set:function(n){r!==n&&(r=n,e.emit("update",t));}});var o=t.height;Object.defineProperty(t,"height",{get:function(){return o},set:function(n){o!==n&&(o=n,e.emit("update",t));}}),t.events=e;}(e);var a=e.events;t.vp=e;var u=function(){s(n,i,r,o,e,t);};a.on("update",u),t.once("destroy",(function(){a.off("update",u),t.vp=void 0;})),Object.defineProperty(t,"vpx",{get:function(){return n},set:function(t){n!==t&&(n=t,u());}}),Object.defineProperty(t,"vpy",{get:function(){return i},set:function(t){i!==t&&(i=t,u());}}),Object.defineProperty(t,"vpxOffset",{get:function(){return r},set:function(t){r!==t&&(r=t,u());}}),Object.defineProperty(t,"vpyOffset",{get:function(){return o},set:function(t){o!==t&&(o=t,u());}}),u();},E=Phaser.Utils.Array.Remove,P={has:function(t){return this.bobs.hasOwnProperty(t)},exists:function(t){return this.bobs.hasOwnProperty(t)},get:function(t){return this.bobs[t]},getGO:function(t){var e=this.get(t);return e?e.gameObject:null},addGO:function(t,e){this.remove(t,!0),this.hasTintFadeEffect(e)&&function(t,e){if(t.hasOwnProperty("tintR"))return t;void 0===e&&(e=16777215);var n=y(e),i=p(e),r=m(e);Object.defineProperty(t,"tint",{get:function(){return e},set:function(o){o=16777215&Math.floor(o),t.setTint&&t.setTint(o),e!==o&&(n=y(e=o),i=p(e),r=m(e));}}),Object.defineProperty(t,"tintR",{get:function(){return n},set:function(i){i=255&Math.floor(i),n!==i&&(n=i,t.tint=(255&i)<<16|65535&e);}}),Object.defineProperty(t,"tintG",{get:function(){return i},set:function(n){n=255&Math.floor(n),i!==n&&(i=n,t.tint=(255&n)<<8|16711935&e);}}),Object.defineProperty(t,"tintB",{get:function(){return r},set:function(n){n=255&Math.floor(n),r!==n&&(r=n,t.tint=255&n|16776960&e);}}),Object.defineProperty(t,"tintGray",{get:function(){return Math.floor((n+i+r)/3)},set:function(e){e=255&Math.floor(e),n===e&&i===e&&r===e||(n=e,i=e,r=e,t.tint=(255&e)<<16|(255&e)<<8|255&e);}}),t.tint=e;}(e),this.viewportCoordinateEnable&&w(e,this.viewport),e.once("destroy",(function(){E(this.removedGOs,e),this.isEmpty&&this.emit("empty");}),this);var n=new this.BobClass(this,e,t);return this.bobs[t]=n,this},add:function(t){for(var e=this.createGameObjectCallback,n=this.createGameObjectScope,i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];var s=e.call.apply(e,[n,this.scene].concat(r));this.addGO(t,s);var a=this.get(t);return this.fadeBob(a,0,1),this},forEachGO:function(t,e){for(var n in this.bobs){var i=this.bobs[n].gameObject;if(e?t.call(e,i,n,this):t(i,n,this))break}return this}},j={remove:function(t,e){if(!this.has(t))return this;var n=this.get(t);return delete this.bobs[t],this.removedGOs.push(n.gameObject),e?n.destroy():this.fadeBob(n,void 0,0,(function(){n.destroy();})),this},removeAll:function(){var t=this.bobs;for(var e in t)this.remove(e);return this},clear:function(t){void 0===t&&(t=!0);var e=this.bobs;for(var n in e)t&&e[n].destroy(),delete e[n];return this.removedGOs.length=0,this}},G={hasProperty:function(t,e){return !!this.has(t)&&this.get(t).hasProperty(e)},getProperty:function(t,e){if(this.has(t))return this.get(t).getProperty(e)},isNumberProperty:function(t,e){return "number"==typeof this.getProperty(t,e)},setProperty:function(t,e,n){return this.has(t)?(this.symbols&&"string"==typeof n&&this.isNumberProperty(t,e)&&(n in this.symbols?n=this.symbols[n]:console.warn("Can't find symbol ".concat(n))),this.get(t).setProperty(e,n),this):this},easeProperty:function(t,e,n,i,r,o,s,a){return this.has(t)?(void 0===i&&(i=1e3),void 0===r&&(r="Linear"),void 0===o&&(o=0),void 0===s&&(s=!1),this.symbols&&"string"==typeof n&&this.isNumberProperty(t,e)&&(n in this.symbols?n=this.symbols[n]:console.warn("Can't find symbol ".concat(n))),this.get(t).easeProperty(e,n,i,r,o,s,a),this):this},hasTweenTask:function(t,e){return !!this.has(t)&&this.get(t).tweens.hasOwnProperty(e)},getTweenTask:function(t,e){if(!this.has(t))return null;var n=this.get(t).tweens[e];return n||null}},_={hasMethod:function(t,e){return !!this.has(t)&&this.get(t).hasMethod(e)},call:function(t,e){var n;if(!this.has(t))return this;for(var i=arguments.length,r=new Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];return (n=this.get(t)).call.apply(n,[e].concat(r)),this}},T={hasData:function(t,e){return !!this.has(t)&&this.get(t).hasData(e)},getData:function(t,e){if(this.has(t))return this.get(t).getData(e)},setData:function(t,e,n){return this.has(t)?(this.get(t).setData(e,n),this):this}},x=function(t){return void 0!==t.displayWidth?t.displayWidth:t.width},C=function(t){return void 0!==t.displayHeight?t.displayHeight:t.height};Phaser.Geom.Rectangle;var k=Phaser.Math.Vector2,S=Phaser.Math.RotateAround,M=void 0,B=function(t,e,n){(void 0===n&&(n=!1),0!==t.rotation&&S(e,t.x,t.y,t.rotation),n&&t.parentContainer)&&t.parentContainer.getBoundsTransformMatrix().transformPoint(e.x,e.y,e);return e},R=Phaser.Utils.Objects.GetValue,L=function(t,e,n,i,r,o,s){if(t.getBounds||void 0!==t.width&&void 0!==t.height){void 0===n&&(n=16777215),void 0===i&&(i=1),void 0===r&&(r=null),void 0===o&&(o=1),void 0===s&&(s=0);var a=function(t,e,n){return void 0===e?e=new k:!0===e&&(void 0===M&&(M=new k),e=M),t.getTopLeft?t.getTopLeft(e):(e.x=t.x-x(t)*t.originX,e.y=t.y-C(t)*t.originY,B(t,e,n))}(t,A[0]);a.x-=s,a.y-=s;var u=function(t,e,n){return void 0===e?e=new k:!0===e&&(void 0===M&&(M=new k),e=M),t.getTopRight?t.getTopRight(e):(e.x=t.x-x(t)*t.originX+x(t),e.y=t.y-C(t)*t.originY,B(t,e,n))}(t,A[1]);u.x+=s,u.y-=s;var h=function(t,e,n){return void 0===e?e=new k:!0===e&&(void 0===M&&(M=new k),e=M),t.getBottomRight?t.getBottomRight(e):(e.x=t.x-x(t)*t.originX+x(t),e.y=t.y-C(t)*t.originY+C(t),B(t,e,n))}(t,A[2]);h.x+=s,h.y+=s;var c=function(t,e,n){return void 0===e?e=new k:!0===e&&(void 0===M&&(M=new k),e=M),t.getBottomLeft?t.getBottomLeft(e):(e.x=t.x-x(t)*t.originX,e.y=t.y-C(t)*t.originY+C(t),B(t,e,n))}(t,A[3]);c.x-=s,c.y+=s,null!==r&&e.fillStyle(r,o).fillPoints(A,!0,!0),null!==n&&e.lineStyle(i,n).strokePoints(A,!0,!0);}},A=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],D={drawGameObjectsBounds:function(t,e){return this.forEachGO((function(n){n.drawBounds?n.drawBounds(t,e):function(t,e,n){var i,r,o,s,a;if("number"==typeof n?i=n:(i=R(n,"color"),r=R(n,"lineWidth"),o=R(n,"fillColor"),s=R(n,"fillAlpha",1),a=R(n,"padding",0)),Array.isArray(t))for(var u=0,h=t.length;u<h;u++)L(t[u],e,i,r,o,s,a);else L(t,e,i,r,o,s,a);}(n,t,e);})),this}};Object.assign(D,d,P,j,G,_,T);var F=Phaser.Cameras.Scene2D.BaseCamera,V=Phaser.Geom.Rectangle,N=function(t,e,n){return e instanceof F||(n=e,e=void 0),void 0===n?n=new V:!0===n&&(n=I),e?t.scale.getViewPort(e,n):t.scale.getViewPort(n)},I=new V,U=Phaser.Utils.Objects.GetValue,X=function(){function e(n,i){t(this,e),this.scene=n,this.BobClass=U(i,"BobClass",l),this.setCreateGameObjectCallback(U(i,"createGameObject"),U(i,"createGameObjectScope")),this.setEventEmitter(U(i,"eventEmitter",void 0));var r=U(i,"fade",500);"number"==typeof r?(this.setGOFadeMode(),this.setGOFadeTime(r)):(this.setGOFadeMode(U(r,"mode")),this.setGOFadeTime(U(r,"time",500)));var o=U(i,"viewportCoordinate",!1);!1!==o?(this.setViewportCoordinateEnable(U(i,"enable",!0)),this.setViewport(U(o,"viewport"))):this.setViewportCoordinateEnable(!1),this.setSymbols(U(i,"symbols")),this.bobs={},this.removedGOs=[],this._timeScale=1;}return n(e,[{key:"destroy",value:function(t){this.clear(!t),this.createGameObjectCallback=void 0,this.viewport=void 0,this.scene=void 0;}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){if(this._timeScale!==t){this._timeScale=t;var e=this.bobs;for(var n in e)e[n].setTimeScale(t);}}},{key:"setTimeScale",value:function(t){return this.timeScale=t,this}},{key:"setCreateGameObjectCallback",value:function(t,e){return this.createGameObjectCallback=t,this.createGameObjectScope=e,this}},{key:"setViewportCoordinateEnable",value:function(t){return void 0===t&&(t=!0),this.viewportCoordinateEnable=t,this}},{key:"setViewport",value:function(t){return void 0===t&&(t=N(this.scene,this.scene.cameras.main)),this.viewport=t,this}},{key:"setSymbols",value:function(t){return this.symbols=t,this}},{key:"isEmpty",get:function(){return function(t){for(var e in t)return !1;return !0}(this.bobs)&&0===this.removedGOs.length}}]),e}();Object.assign(X.prototype,h,D);var Y=Phaser.Utils.Objects.GetValue,W=function(e){i(s,e);var o=a(s);function s(e,n){var i;t(this,s),void 0===n?n={}:Array.isArray(n)&&(n={layers:n}),n.hasOwnProperty("fade")||(n.fade=0),n.viewportCoordinate=!1,i=o.call(this,e,n);var r=Y(n,"layers");if(r)for(var a=0,u=r.length;a<u;a++)i.add(r[a]);return i}return n(s,[{key:"setCreateGameObjectCallback",value:function(t,e){return t||(t=H),u(r(s.prototype),"setCreateGameObjectCallback",this).call(this,t,e),this}},{key:"addGO",value:function(t,e){return u(r(s.prototype),"addGO",this).call(this,t,e),e.name=t,this}},{key:"getLayer",value:function(t){return this.getGO(t)}},{key:"getLayers",value:function(t){return void 0===t&&(t=[]),this.forEachGO((function(e){t.push(e);})),function(t,e){if(t.length<=1)return t;void 0===e&&(e=!1);var n=t[0].scene.sys.displayList;n.depthSort(),e?t.sort((function(t,e){return n.getIndex(e)-n.getIndex(t)})):t.sort((function(t,e){return n.getIndex(t)-n.getIndex(e)}));}(t,!1),t}},{key:"addToLayer",value:function(t,e){var n=this.getGO(t);if(n)return e.isRexContainerLite?e.addToLayer(n):n.add(e),this;console.warn("Can't get layer \"".concat(t,'"'));}}]),s}(X),H=function(t,e){var n=t.add.layer();return void 0!==e&&n.setDepth(e),n};return function(e){i(o,Phaser.Plugins.BasePlugin);var r=a(o);function o(e){return t(this,o),r.call(this,e)}return n(o,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this);}},{key:"add",value:function(t,e){return new W(t,e)}}]),o}()}));
