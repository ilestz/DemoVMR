!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexquadimageplugin=t();}(undefined,(function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n);}}function n(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t);}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return !1;if(Reflect.construct.sham)return !1;if("function"==typeof Proxy)return !0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return !1}}();return function(){var i,n=o(e);if(t){var r=o(this).constructor;i=Reflect.construct(n,arguments,r);}else i=n.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return a(e)}(this,i)}}function h(){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(arguments.length<3?e:i):r.value}},h.apply(this,arguments)}function c(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return ("string"===t?String:Number)(e)}(e,"string");return "symbol"==typeof t?t:String(t)}var l=Phaser.Math.RotateAround,f=function(e,t,i){var n=e.width/2,r=e.height/2;return d.x=t-n,d.y=i-r,l(d,0,0,e.rotation),d.x*=e.scaleX,d.y*=e.scaleY,d.x+=e.x,d.y+=e.y,d},d={x:0,y:0},y=function(){function e(i,n){t(this,e),this.parent=i,this.vertex=n,this._localX=void 0,this._localY=void 0;}return n(e,[{key:"destroy",value:function(){this.parent=void 0,this.vertex=void 0;}},{key:"updateVertexPosition",value:function(e,t){var i=this.parent,n=i.height,r=e/n-i.frame.cutWidth/n/2,o=t/n-i.frame.cutHeight/n/2,s=this.vertex;return s.x=r,s.y=-o,i.forceUpdate(),this}},{key:"localX",get:function(){return this._localX},set:function(e){this.setLocalXY(e,this._localY);}},{key:"localY",get:function(){return this._localY},set:function(e){this.setLocalXY(this._localX,e);}},{key:"localXOrigin",get:function(){return this._localXOrigin}},{key:"localYOrigin",get:function(){return this._localYOrigin}},{key:"resetLocalXY",value:function(e,t){return this._localXOrigin=e,this._localYOrigin=t,this._localX=e,this._localY=t,this}},{key:"setLocalXY",value:function(e,t,i){return this._localX===e&&this._localY===t||(this._localX=e,this._localY=t,i||this.updateVertexPosition(e,t)),this}},{key:"setWorldXY",value:function(e,t){if(this._worldX===e&&this._worldY===t)return this;var i,n,r,o,s,a=(i=this.parent,n=e,r=t,o=i.width/2,s=i.height/2,d.x=n-i.x,d.y=r-i.y,d.x/=i.scaleX,d.y/=i.scaleY,l(d,0,0,-i.rotation),d.x+=o,d.y+=s,d);return this.setLocalXY(a.x,a.y),this}},{key:"setPosition",value:function(e,t){return this.setWorldXY(e,t),this}},{key:"getWorldXY",value:function(){return f(this.parent,this._localX,this._localY)}},{key:"x",get:function(){return f(this.parent,this._localX,this._localY).x},set:function(e){this.setWorldXY(e,this.y);}},{key:"y",get:function(){return f(this.parent,this._localX,this._localY).y},set:function(e){this.setWorldXY(this.x,e);}}]),e}(),v=Phaser.Geom.Mesh.Vertex,g=Phaser.Geom.Mesh.Face,p=[0,2,3,0,3,1],x=[1,3,2,1,2,0],w=[0,3,4,0,4,1,1,4,2,4,5,2,3,6,4,6,7,4,4,7,8,4,8,5],b=Phaser.GameObjects.Mesh,m=Phaser.Utils.Objects.IsPlainObject,k=Phaser.Utils.Objects.GetValue,P=function(e){r(s,e);var i=u(s);function s(e,n,r,o,u,h){var c;return t(this,s),m(n)&&(n=k(h=n,"x",0),r=k(h,"y",0),o=k(h,"key",null),u=k(h,"frame",null)),(c=i.call(this,e,n,r,o,u)).type="rexQuadImage",c.isNinePointMode=k(h,"ninePointMode",!1),c.fourPointsModeRTL=k(h,"rtl",!1),c.controlPoints=[],function(e){for(var t,i=e.isNinePointMode,n=i?9:4,r=e.vertices,o=e.faces,s=e.controlPoints,a=0;a<n;a++){var u=new v;r.push(u),s.push(new y(e,u));}a=0;for(var h=(t=i?w:e.fourPointsModeRTL?x:p).length;a<h;a+=3){var c=r[t[a+0]],l=r[t[a+1]],f=r[t[a+2]];o.push(new g(c,l,f));}i?(e.topLeft=s[0],e.topCenter=s[1],e.topRight=s[2],e.centerLeft=s[3],e.center=s[4],e.centerRight=s[5],e.bottomLeft=s[6],e.bottomCenter=s[7],e.bottomRight=s[8]):(e.topLeft=s[0],e.topRight=s[1],e.bottomLeft=s[2],e.bottomRight=s[3]);}(a(c)),c.hideCCW=!1,c.syncSize(),c}return n(s,[{key:"destroy",value:function(e){if(this.scene&&!this.ignoreDestroy){h(o(s.prototype),"destroy",this).call(this,e);for(var t=0,i=this.controlPoints.length;t<i;t++)this.controlPoints[t].destroy();this.controlPoints=void 0;}}},{key:"resetVerts",value:function(){this.dirtyCache[9]=-1;for(var e=function(e){var t,i=e.height,n=e.width;if(e.isNinePointMode){var r=(0+n)/2,o=(0+i)/2;t=[0,0,r,0,n,0,0,o,r,o,n,o,0,i,r,i,n,i];}else t=[0,0,n,0,0,i,n,i];return t}(this),t=this.width,i=this.height,n=this.frame.cutWidth/i/2,r=this.frame.cutHeight/i/2,o=this.frame.u0,s=this.frame.u1,a=this.frame.v0,u=s-o,h=this.frame.v1-a,c=this.controlPoints,l=0,f=e.length;l<f;l+=2){var d=e[l+0],y=e[l+1],v=l/2,g=d/i-n,p=y/i-r,x=o+u*(d/t),w=a+h*(y/i);this.vertices[v].set(g,-p,0).setUVs(x,w),c[v].resetLocalXY(d,y);}return this}},{key:"syncSize",value:function(){return this.setSizeToFrame(),this.setOrtho(this.width/this.height,1),this.resetVerts(),this}},{key:"forceUpdate",value:function(){return this.dirtyCache[10]=1,this}},{key:"tint",get:function(){return 0===this.vertices.length?16777215:this.vertices[0].color}}]),s}(b);function O(e,t,i,n,r){var o=new P(this.scene,e,t,i,n,r);return this.scene.add.existing(o),o}var j=Phaser.Utils.Objects.GetAdvancedValue,X=Phaser.GameObjects.BuildGameObject;function Y(e,t){void 0===e&&(e={}),void 0!==t&&(e.add=t);var i=j(e,"key",null),n=j(e,"frame",null),r=new P(this.scene,0,0,i,n,e);return X(this.scene,r,e),r}var _,R=Phaser.Textures.DynamicTexture,S=function(e,t,i){return void 0===t&&(t=2),void 0===i&&(i=2),new R(e.sys.textures,null,t,i)},T=function(e){return void 0!==e.displayWidth?e.displayWidth:e.width},G=function(e){return void 0!==e.displayHeight?e.displayHeight:e.height},M=Phaser.Geom.Rectangle,V=Phaser.Math.Vector2,U=Phaser.Math.RotateAround,C=function(e,t){if(void 0===t?t=new M:!0===t&&(void 0===D&&(D=new M),t=D),e.getBounds)return e.getBounds(t);var i,n,r,o,s,a,u,h;if(e.parentContainer){var c=e.parentContainer.getBoundsTransformMatrix();B(e,t),c.transformPoint(t.x,t.y,t),i=t.x,n=t.y,L(e,t),c.transformPoint(t.x,t.y,t),r=t.x,o=t.y,I(e,t),c.transformPoint(t.x,t.y,t),s=t.x,a=t.y,W(e,t),c.transformPoint(t.x,t.y,t),u=t.x,h=t.y;}else B(e,t),i=t.x,n=t.y,L(e,t),r=t.x,o=t.y,I(e,t),s=t.x,a=t.y,W(e,t),u=t.x,h=t.y;return t.x=Math.min(i,r,s,u),t.y=Math.min(n,o,a,h),t.width=Math.max(i,r,s,u)-t.x,t.height=Math.max(n,o,a,h)-t.y,t},D=void 0,B=function(e,t,i){return void 0===t?t=new V:!0===t&&(void 0===A&&(A=new V),t=A),e.getTopLeft?e.getTopLeft(t):(t.x=e.x-T(e)*e.originX,t.y=e.y-G(e)*e.originY,z(e,t,i))},L=function(e,t,i){return void 0===t?t=new V:!0===t&&(void 0===A&&(A=new V),t=A),e.getTopRight?e.getTopRight(t):(t.x=e.x-T(e)*e.originX+T(e),t.y=e.y-G(e)*e.originY,z(e,t,i))},I=function(e,t,i){return void 0===t?t=new V:!0===t&&(void 0===A&&(A=new V),t=A),e.getBottomLeft?e.getBottomLeft(t):(t.x=e.x-T(e)*e.originX,t.y=e.y-G(e)*e.originY+G(e),z(e,t,i))},W=function(e,t,i){return void 0===t?t=new V:!0===t&&(void 0===A&&(A=new V),t=A),e.getBottomRight?e.getBottomRight(t):(t.x=e.x-T(e)*e.originX+T(e),t.y=e.y-G(e)*e.originY+G(e),z(e,t,i))},A=void 0,z=function(e,t,i){(void 0===i&&(i=!1),0!==e.rotation&&U(t,e.x,e.y,e.rotation),i&&e.parentContainer)&&e.parentContainer.getBoundsTransformMatrix().transformPoint(t.x,t.y,t);return t},H=Phaser.Geom.Rectangle,Q=Phaser.Geom.Rectangle.Union,E=function(t,i){var n=Array.isArray(t);if(void 0===i?i=n?[]:{}:function(t){if("object"!==e(t)||null===t)return t;if(Array.isArray(t))t.length=0;else for(var i in t)delete t[i];}(i),n){i.length=t.length;for(var r=0,o=t.length;r<o;r++)i[r]=t[r];}else for(var s in t)i[s]=t[s];return i},N=Phaser.GameObjects.GameObject,F=Phaser.Utils.Objects.GetValue,q=Phaser.Textures.DynamicTexture,J=Phaser.Utils.String.UUID,K=function(e){if(e){var t,i,n=e.gameObjects,r=e.renderTexture,o=F(e,"x",void 0),s=F(e,"y",void 0),a=F(e,"width",void 0),u=F(e,"height",void 0),h=F(e,"originX",0),c=F(e,"originY",0),l=F(e,"padding",0);if(void 0===a||void 0===u||void 0===o||void 0===s){var f=function(e,t){var i;void 0===t?t=new H:!0===t&&(void 0===_&&(_=new H),t=_),t.setTo(0,0,0,0);for(var n=!0,r=0,o=e.length;r<o;r++)if((i=e[r]).getBounds){var s=C(i,!0);n?(t.setTo(s.x,s.y,s.width,s.height),n=!1):Q(s,t,t);}return t}(n,!0);void 0!==o&&void 0!==s?(a=2*Math.max(o-f.left,f.right-o),u=2*Math.max(s-f.top,f.bottom-s),h=.5,c=.5):(o=f.x,s=f.y,a=f.width,u=f.height,h=0,c=0),t=f.x,i=f.y;}else t=o+(0-h)*a,i=s+(0-c)*u;t-=l,i-=l,a+=2*l,u+=2*l;var d=n[0].scene;y&&!r&&(r=new q(d.sys.textures,J(),a,u)),r||(r=d.add.renderTexture(0,0,a,u)),r.setPosition&&r.setPosition(o,s),r.width===a&&r.height===u||r.setSize(a,u),r.setOrigin&&r.setOrigin(h,c),r.camera.setScroll(t,i),n=function(e,t){if(e.length<=1)return e;void 0===t&&(t=!1);var i=e[0].scene.sys.displayList;return i.depthSort(),t?e.sort((function(e,t){return i.getIndex(t)-i.getIndex(e)})):e.sort((function(e,t){return i.getIndex(e)-i.getIndex(t)})),e}(E(n)),r.draw(n);var y=e.saveTexture;if(y)if(r instanceof N)r.saveTexture(y);else {var v=r,g=v.manager;g.exists(v.key)?g.renameTexture(v.key,key):(v.key=key,g.list[key]=v,g.emit("addtexture",key,v),g.emit("addtexture-".concat(key),v));}return r}},Z=Phaser.Utils.Objects.IsPlainObject,$=Phaser.Utils.Objects.GetValue,ee=function(e){r(s,e);var i=u(s);function s(e,n,r,o,a,u){var h;t(this,s),Z(n)&&(n=$(u=n,"x",0),r=$(u,"y",0),o=$(u,"width",32),a=$(u,"height",32));var c=S(e,o,a);return (h=i.call(this,e,n,r,c,null,u)).type="rexQuadRenderTexture",h.rt=h.texture,h}return n(s,[{key:"destroy",value:function(e){this.scene&&!this.ignoreDestroy&&(h(o(s.prototype),"destroy",this).call(this,e),this.rt.destroy(),this.rt=null);}},{key:"snapshot",value:function(e,t){return void 0===t&&(t={}),t.gameObjects=e,t.renderTexture=this.rt,K(t),this.width===this.frame.realWidth&&this.height===this.frame.realHeight||this.syncSize(),this}}]),s}(P);function te(e,t,i,n,r){var o=new ee(this.scene,e,t,i,n,r);return this.scene.add.existing(o),o}var ie=Phaser.Utils.Objects.GetAdvancedValue,ne=Phaser.GameObjects.BuildGameObject;function re(e,t){void 0===e&&(e={}),void 0!==t&&(e.add=t);var i=ie(e,"x",0),n=ie(e,"y",0),r=ie(e,"width",32),o=ie(e,"height",32),s=new ee(this.scene,i,n,r,o,e);return ne(this.scene,s,e),s}var oe=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0);for(var n=.5*e.width,r=.5*e.height,o=Math.tan(t)*r,s=Math.tan(i)*n,a=e.controlPoints,u=0,h=a.length;u<h;u++){var c=a[u],l=c.localXOrigin,f=c.localYOrigin;c.localX=l+(f>r?o:-o),c.localY=f+(l>n?s:-s);}},se=Phaser.Utils.Objects.IsPlainObject,ae=Phaser.Utils.Objects.GetValue,ue=Phaser.Math.DegToRad,he=Phaser.Math.RadToDeg,ce=function(e){r(o,e);var i=u(o);function o(e,n,r,s,a){var u;if(t(this,o),se(n)){var h=n;n=ae(h,"x",0),r=ae(h,"y",0),s=ae(h,"key",null),a=ae(h,"frame",null);}return (u=i.call(this,e,n,r,s,a)).type="rexSkewmage",u._skewX=0,u._skewY=0,u}return n(o,[{key:"skewX",get:function(){return this._skewX},set:function(e){this._skewX=e,oe(this,this._skewX,this._skewY);}},{key:"skewXDeg",get:function(){return he(this._skewX)},set:function(e){this.skewX=ue(e);}},{key:"skewY",get:function(){return this._skewY},set:function(e){this._skewY=e,oe(this,this._skewX,this._skewY);}},{key:"skewYDeg",get:function(){return he(this._skewY)},set:function(e){this.skewY=ue(e);}},{key:"setSkewX",value:function(e){return this.skewX=e,this}},{key:"setSkewY",value:function(e){return this.skewY=e,this}},{key:"setSkew",value:function(e,t){return void 0===t&&(t=e),this.skewX=e,this.skewY=t,this}},{key:"setSkewXDeg",value:function(e){return this.skewXDeg=e,this}},{key:"setSkewYDeg",value:function(e){return this.skewYDeg=e,this}},{key:"setSkewDeg",value:function(e,t){return void 0===t&&(t=e),this.skewXDeg=e,this.skewYDeg=t,this}}]),o}(P);function le(e,t,i,n){var r=new ce(this.scene,e,t,i,n);return this.scene.add.existing(r),r}var fe=Phaser.Utils.Objects.GetAdvancedValue,de=Phaser.GameObjects.BuildGameObject;function ye(e,t){void 0===e&&(e={}),void 0!==t&&(e.add=t);var i=fe(e,"key",null),n=fe(e,"frame",null),r=new ce(this.scene,0,0,i,n);return de(this.scene,r,e),r}var ve=Phaser.Utils.Objects.IsPlainObject,ge=Phaser.Utils.Objects.GetValue,pe=function(e){r(s,e);var i=u(s);function s(e,n,r,o,a){var u;if(t(this,s),ve(n)){var h=n;n=ge(h,"x",0),r=ge(h,"y",0),o=ge(h,"width",32),a=ge(h,"height",32);}var c=S(e,o,a);return (u=i.call(this,e,n,r,c,null)).type="rexSkewRenderTexture",u.rt=u.texture,u}return n(s,[{key:"destroy",value:function(e){this.scene&&!this.ignoreDestroy&&(h(o(s.prototype),"destroy",this).call(this,e),this.rt.destroy(),this.rt=null);}}]),s}(ce);function xe(e,t,i,n){var r=new pe(this.scene,e,t,i,n);return this.scene.add.existing(r),r}var we=Phaser.Utils.Objects.GetAdvancedValue,be=Phaser.GameObjects.BuildGameObject;function me(e,t){void 0===e&&(e={}),void 0!==t&&(e.add=t);var i=we(e,"x",0),n=we(e,"y",0),r=we(e,"width",32),o=we(e,"height",32),s=new pe(this.scene,i,n,r,o);return be(this.scene,s,e),s}var ke=Phaser.Utils.Objects.GetValue,Pe=function(e,t){if(!e)return !1;for(var i=t.visibleSibling,n=0,r=i.length;n<r;n++)e.setChildVisible(i[n],!0);return i.length=0,e.setChildVisible(t,!1),t.isRunning=!1,!0},Oe=function(e){r(o,e);var i=u(o);function o(){return t(this,o),i.apply(this,arguments)}return n(o,[{key:"skewState",get:function(){return this.isRunning}}]),o}(function(e){r(s,e);var i=u(s);function s(e,n){var r;t(this,s);var o=e.scene;return r=i.call(this,o,0,0,1,1,n),o.add.existing(a(r)),function(e,t,i){t.visibleSibling=[],t.isRunning=!1,t.useParentBounds=ke(i,"useParentBounds",!1),t.setPosition(e.x,e.y).setVisible(!1),e.pin(t);}(e,a(r),n),r}return n(s,[{key:"destroy",value:function(e){this.scene&&!this.ignoreDestroy&&(this.exit(),h(o(s.prototype),"destroy",this).call(this,e));}},{key:"enter",value:function(){return function(e,t){if(!e)return !1;Pe(e,t);var i=t.useParentBounds;K({gameObjects:e.getAllVisibleChildren(),renderTexture:t.rt,x:t.x,y:t.y,width:i?e.displayWidth:void 0,height:i?e.displayHeighth:void 0,originX:i?e.originX:void 0,originY:i?e.originY:void 0}),e.setChildVisible(t,!0);for(var n=t.visibleSibling,r=e.children,o=0,s=r.length;o<s;o++){var a=r[o];a.visible&&a!==t&&(e.setChildVisible(a,!1),n.push(a));}return t.isRunning=!0,!0}(this.rexContainer.parent,this)&&this.syncSize(),this}},{key:"exit",value:function(){return Pe(this.rexContainer.parent,this),this}}]),s}(pe)),je=function(e){return null==e||""===e||0===e.length},Xe=function(t,i,n,r){if(void 0===r&&(r="."),"object"===e(t)){if(je(i)){if(null==n)return;"object"===e(n)&&(t=n);}else {"string"==typeof i&&(i=i.split(r));var o=i.pop(),s=function(t,i,n){var r=t;if(je(i));else {var o;"string"==typeof i&&(i=i.split("."));for(var s=0,a=i.length;s<a;s++){var u;null!=r[o=i[s]]&&"object"===e(r[o])||(u=s===a-1?void 0===n?{}:n:{},r[o]=u),r=r[o];}}return r}(t,i);s[o]=n;}return t}},Ye=function(e){r(o,Phaser.Plugins.BasePlugin);var i=u(o);function o(e){var n;return t(this,o),n=i.call(this,e),e.registerGameObject("rexQuadImage",O,Y),e.registerGameObject("rexQuadRenderTexture",te,re),e.registerGameObject("rexSkewImage",le,ye),e.registerGameObject("rexSkewRenderTexture",xe,me),n}return n(o,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this);}},{key:"addContainerSkew",value:function(e,t){return new Oe(e,t)}}]),o}();return Xe(window,"RexPlugins.GameObjects.QuadImage",P),Xe(window,"RexPlugins.GameObjects.QuadRenderTexture",ee),Xe(window,"RexPlugins.GameObjects.SkewImage",ce),Xe(window,"RexPlugins.GameObjects.SkewRenderTexture",pe),Xe(window,"RexPlugins.GameObjects.ContainerSkew",Oe),Ye}));
